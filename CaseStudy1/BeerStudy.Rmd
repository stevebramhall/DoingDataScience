---
title: "MSDS6306 Sect404 Case Study 1-Beer Study"
author: "Steve Bramhall, Lei Jiang"
date: "October 1, 2018"
output: html_document
---

```{r message=FALSE, warning=FALSE}
# Load Libraries
library(dplyr)
library(ggplot2)
```

```{r}
# Read beer data from csv file and put into beerDF data frame.Then rename columns to be more readable.
beerDF <- read.csv(".\\ImportFiles\\Beers.csv",header=TRUE,sep=",",stringsAsFactors = FALSE)
names(beerDF) <- c("BeerName","BeerID","AlcoholByVolume","BitternessUnits","BreweryID",
                   "BeerStyle","Ounces") # rename table columns

# Read brewery data from csv file and put into breweryDF data frame.Then rename columns to be more readable.
breweryDF <- read.csv(".\\ImportFiles\\Breweries.csv",header=TRUE,sep=",",stringsAsFactors = FALSE)
names(breweryDF) <- c("BreweryID","BreweryName","City","State") # rename table columns
```

```{r}
#Q1 Obtain number of breweries in each state using group_by function in library dplyr,
#  then show data with the summarize function
breweryStateCnt <- group_by(breweryDF,State)
summarize(breweryStateCnt,count=n())
```
```{r}
# --testing removing erroneous characters--
#unwanted_array = list("â€™"="'","Â°"="*","Ã¤"="a","Ã¨"="e","Ã©"="e","Ã�"="i","Ã¶"="o","Ã¼"="u","â„¢"="")
#iconv(beerDF$BeerName,"UTF-8","ASCII//TRANSLIT")
#chartr("â€™"="'",beerDF$BeerName)
#chartr("â€™"="'",beerDF$BeerStyle)
#chartr("Ã¶"="o",beerDF$BeerName)
#chartr("Ã¶"="o",beerDF$BeerStyle)


# Q2 Merge brewery and beer data into brewDataDF data frame
allBeerDataDF <- merge.data.frame(breweryDF,beerDF,by="BreweryID")
#write.table(allBeerDataDF,".\\OutputFiles\\MergedBeerData1.csv",quote=FALSE,sep=',',row.names=FALSE)
head(allBeerDataDF,6)
tail(allBeerDataDF,6)
```

```{r}
# Q3 Report NA count, put in data frame for easier display options
naCountDF <-as.data.frame(sapply(allBeerDataDF, function(x) sum(length(which(is.na(x))))))
names(naCountDF) <- ("NA Count") # rename columns
naCountDF
```

```{r}
#Q4 Create plot data for the median alcohol content and international bitterness unit for each state,
#   then plot
#
# Add median column for Alcohol Content and Bitterness Units
allBeerDataDF$medianAlcoholContent <- sapply(allBeerDataDF$AlcoholByVolume,median)
allBeerDataDF$medianBitternesUnits <- sapply(allBeerDataDF$BitternessUnits,median)
medianAlcholBitternessPlotData <- data.frame("State" = allBeerDataDF$State,
                       "MedianAlcoholContent" = allBeerDataDF$medianAlcoholContent,
                       "MedianBitternessUnits" = allBeerDataDF$BitternessUnits,
                       stringsAsFactors = FALSE)
ggplot(medianAlcholBitternessPlotData) +    
    aes(x=MedianAlcoholContent,y=MedianBitternessUnits,fill=medianAlcholBitternessPlotData$State) +   
    geom_bar(stat="identity") 

#The plot needs discussion on the be way to present & deal with NA's

```

```{r}
# Q5 still in progress, not working
maxDataByState <- group_by(allBeerDataDF,State) %>% summarize(AlcoholByVolume=max(AlcoholByVolume,na.rm=TRUE))

maxDataByState$BitternessUnits<- group_by(allBeerDataDF,State) %>% summarize(BitternessUnits=max(BitternessUnits,na.rm=TRUE))

```

